<!--
<html>
<head>
<link rel="stylesheet" href="/BookTracker/scripts/amazonResults.css">
<script src="/BookTracker/scripts/mootools-core.js"></script>
<script src="/BookTracker/scripts/mootools-more.js"></script>
-->
<script type="text/javascript">
	window.addEvent('resize', function() {
		$('amazon').setStyle('height',$('amazon').getParent().getParent().getStyle('height').toInt());
	});
	//window.addEvent('domready',function() {
	//var jsonRequest = new Request({url: "/BookTracker/AmazonQuery",  onSuccess: function(text){
	//	var json = eval("("+text+")");
	//	if(json && json.data) loadQuery(json.data);
	//}}).get({'keyword': 'Terry Pratchett'});
	//});
	var amazCurrPage = 1;
	function loadQuery(json){
		var i=0;
		if(json.totPages && json.totPages > 1){
			var back = amazCurrPage==1?'&nbsp;':'<a href="#" onClick="javascript:getQuery(null, -1);amazCurrPage--;"><</a>';
			var fore = amazCurrPage==json.totPages?'&nbsp;':'<a href="#" onClick="javascript:getQuery(null, 1);amazCurrPage++;">></a>';
			$('pages').set('html', back+' page '+amazCurrPage+' of '+json.totPages+' '+fore);
		}
		
		$('amazon').set('html','');
		if(json.data) {
			while(json.data[i]){
				var div = new Element('div', {id: 'result'+i, class: 'entry'});
				var dataDiv = new Element('div', {class: 'json.data'});
				var leftDiv = new Element('div', {class: 'left'});
				var img = new Element('img', {src: json.data[i].small_url});
				var addLib = new Element('a',{'href':'#'}).set('html','add Lib')
				addLib.isbn = json.data[i].isbn;
				addLib.addEvent('click', function(){
					submitRequest(this.isbn, null)
					//alert(this.isbn);
				});
				var addPlay = new Element('a',{'href':'#'}).set('html','add Ply');
				
				var libLink = new Element('a',{'href':'#'}).set('html','library');
				var amazLink = new Element('a',{'href':json.data[i].detailUrl}).set('html','amazon');
				var title = new Element('div').set('html',json.data[i].title).set('class','title');
				var author = new Element('div').set('html','by: '+json.data[i].author);
				var rating = new Element('div').set('html',json.data[i].amaz_rating);
				var tags = new Element('div').set('class','tags');
				if(json.data[i].tags)
					tags.set('html',json.data[i].tags.replace(/,/g,", "));
				dataDiv.grab(title).grab(author).grab(rating).grab(tags);
				leftDiv.grab(img).grab(addLib).grab(addPlay).grab(libLink).grab(amazLink);
				div.grab(leftDiv).grab(dataDiv);
				$('amazon').grab(div);
				i++;
			}
		}
		var mySortables = new Sortables('amazon',{clone: true});
		//window.fireEvent('resize');
	}
	function submitRequest(isbn, playlist) {
		var request = new Request({url: "/BookTracker/AddBook",  onSuccess: function(text){
			alert('success!');
		}});
		alert(isbn);
		if(playlist)
			request.get({'playlist': playlist, 'isbn':isbn});
		else request.get({'isbn':isbn});
	}
</script>
<!--
</head>
<body>
-->
<div id="pages"></div>
<div id="amazon">
</div>
<!--
</body>
</html>
-->